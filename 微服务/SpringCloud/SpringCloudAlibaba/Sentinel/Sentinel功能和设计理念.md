## <font color='red'>Sentinel 功能和设计理念</font>





- ### <font color='orange'>流量控制</font>

  

  - #### 流量控制在网络传输中是一个常用的概念，它用于调整网络包的发送数据。然而，从系统稳定性角度考虑，在处理请求的速度上，也有非常多的讲究。任意时间到来的请求往往是随机不可控的，而系统的处理能力是有限的。我们需要根据系统的处理能力对流量进行控制。Sentinel 作为一个调配器，可以根据需要把随机的请求调整成合适的形状

  - ![arch](Sentinel%E5%8A%9F%E8%83%BD%E5%92%8C%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5.assets/sentinel-flow-overview.jpg)

  - #### 流量控制有多个角度

    - ##### 资源的调用关系，例如资源的调用链路，资源和资源之间的关系

    - ##### 运行指标，例如 QPS、线程池、系统负载等

    - ##### 控制的效果，例如直接限流、冷启动、排队等





<hr>





- ### <font color='orange'>熔断服务</font>

  

  - #### 降低调用链路中的不稳定资源也是Sentinel的使命之一。由于调用关系的复杂性，如果调用链路中的某个资源出现了不稳定，最终会导致请求发生堆积。这个问题和 Hystrix 里面描述的是一样的。

  - <img src="Sentinel%E5%8A%9F%E8%83%BD%E5%92%8C%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5.assets/62410811-cd871680-b61d-11e9-9df7-3ee41c618644-16382494886703.png" alt="image" style="zoom:67%;" />
  
  - #### Sentinel和Hystrix的原则是一致的：当调用链路中某个资源出现了不稳定，例如 timeout 异常比例提高的时候，则对这个资源的调用进行了限制，并让请求快速失败，避免影响到其他资源，最终产生雪崩效应。
  
    
  
  - ### <font color='orange'>熔断降级的设计理念</font>
  
  - #### 在限制方法上，Sentinel和Hystrix 采取完全不一样的方法。
  
    - #### <font color='red'>Hystrix </font>通过线程池的方式，来对依赖(资源)进行隔离。这样做的好处是资源和资源之间做到了最彻底的隔离。缺点是增加了线程切换的成本，还需要预先给各个资源做线程大小的分配。
  
  
    - #### <font color='red'>通过并发线程数</font>
  
      - #### 和资源池隔离的方法不同，Sentinel通过限制资源并发线程的数量，来减少不稳定资源和对其他资源的影响。这样不但没有线程切换的损耗，也不需要预先分配线程池的小大。当某个资源出现不稳定的情况下,如响应时间变长，对资源的直接影响就会造成线程数的逐步累积。当线程数在特定资源上堆积到一定的数量之后，对该资源的新请求就会被拒绝。堆积的线程完成任务后才开始继续接收请求。
  
    - #### <font color='red'>通过响应时间对资源进行降级</font> 
  
      - #### 除了对并发线程数进行控制以外，Sentinel 还可以通过响应时间来快速降级不稳定的资源。当依赖的资源出现响应时间过长后，所有对该资源的访问都会被直接拒绝，直到过了指定的时间窗口之后才重新恢复。
  
    
  
  - ### <font color='orange'>系统负载保护</font>
  
  - #### Sentinel 同时提供<font color='cornflowerblue'> 系统维度的自适应保护能力</font> 。防止雪崩，是系统防护中重要的以环。当系统负载较高的时候，如果还持续让请求进入，可能会导致系统崩溃，无法响应。在集群环境下























